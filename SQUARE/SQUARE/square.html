<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>WebGL Buttons Example</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js" defer></script>
  <script type="text/javascript" src="../../Common/webgl-utils.js" defer></script>
  <script type="text/javascript" src="../../Common/initShaders.js" defer></script>
  <script type="text/javascript" src="../../Common/MV.js" defer></script>
  <script type="text/javascript" src="square.js" defer></script>
  <style type="text/css" src="style.css">
  canvas {
    width: 512px;
    height: 512px;
  }
</style>
</head>


<script id="vertex-shader" type="x-shader/x-vertex">

attribute vec4 vPosition;
attribute vec4 vColor;

varying vec4 fColor;

void
main()
{
    gl_Position = vPosition;
    fColor = vColor;
    gl_PointSize = 10.0;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

varying vec4 fColor;

void
main()
{
    gl_FragColor = fColor;
}
</script>
<style type="text/css" src="style.css"></style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
<script type="text/javascript" src="../../Common/webgl-utils.js"></script>
<script type="text/javascript" src="../../Common/initShaders.js"></script>
<script type="text/javascript" src="../../Common/MV.js"></script>
<script type="text/javascript" src="square.js"></script>

<body>

  <canvas id="gl-canvas" width="512" height="512">
    Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
<div id="buttons">
  <button onclick="randomizePoints()">generate points</button>
  <button onclick="runDelaunay()">Delaunay Triangulation</button>
  <button onclick="clear()">clear</button>
</div>
<script>
const canvas = document.getElementById("canvas");
const renderer = new THREE.WebGLRenderer({canvas});
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 0.1, 1000);
camera.position.set(0, 0, 5);

// Setup points and geometry
const geometry = new THREE.BufferGeometry();
const material = new THREE.PointsMaterial({color: 0xffffff, size: 0.1});
const points = new THREE.Points(geometry, material);
scene.add(points);

// Initialize Delaunay triangulation
const delaunay = new THREE.Delaunay();

// Randomize points function
function randomizePoints() {
  const positions = [];
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * 2 - 1;
    const y = Math.random() * 2 - 1;
    positions.push(x, y, 0);
  }
  geometry.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));
}

function clearScene() {

  const previousMesh = scene.getObjectByName("mesh");
  if (previousMesh) {
    scene.remove(previousMesh);
  }

  scene.children.forEach((object) => {
    if (object.type === "Mesh" || object.type === "Points") {
      scene.remove(object);
    }
  });
}

// Delaunay triangulation function
function runDelaunay() {

  const previousMesh = scene.getObjectByName("mesh");
  if (previousMesh) {
    scene.remove(previousMesh);
  }
  

  const positions = geometry.getAttribute("position").array;
  const indices = delaunay.triangulate(positions);
  const newGeometry = new THREE.BufferGeometry();
  newGeometry.setIndex(indices);
  newGeometry.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));
  const mesh = new THREE.Mesh(newGeometry, new THREE.MeshBasicMaterial({color: 0xff0000}));
  mesh.name = "mesh";
  scene.add(mesh);
}

// Add event listener to button
const button = document.getElementById("generate");
button.addEventListener("click", () => {
  randomizePoints();
  runDelaunay();
});

</script>
</body>

</html>
